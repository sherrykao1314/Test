<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>外幣模擬考試系統</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.0/papaparse.min.js"></script>
    <style>
        /* 試卷底色 */
        body { 
            background-color: #e9e9e9; 
            font-family: "Microsoft JhengHei", -apple-system, BlinkMacSystemFont, sans-serif;
            margin: 0; padding: 10px;
            display: flex; justify-content: center;
            /* 禁止手機上選取文字，避免按鈕操作時誤選 */
            -webkit-user-select: none; user-select: none;
        }

        /* 模擬紙張樣式 */
        .paper {
            background-color: #fffaf0; /* 象牙白 */
            width: 100%; max-width: 600px;
            min-height: 95vh;
            padding: 40px 25px;
            box-shadow: 0 0 20px rgba(0,0,0,0.15);
            border: 1px solid #dcdcdc;
            position: relative;
            box-sizing: border-box;
        }

        /* 試卷標題區 */
        .exam-header {
            text-align: center;
            border-bottom: 2px solid #333;
            margin-bottom: 25px;
            padding-bottom: 15px;
        }
        .exam-title { 
            font-size: 1.5rem; font-weight: bold; letter-spacing: 1px; margin: 0 0 10px 0; color: #222;
        }
        .exam-info { font-size: 1rem; color: #555; }

        /* 題目內容 */
        .question-section { margin-top: 40px; min-height: 180px; }
        #question-content { 
            white-space: pre-wrap; font-size: 1.25rem; line-height: 1.7; color: #2d3436;
        }

        /* 答案圈圈區域 */
        .answer-sheet {
            margin-top: 50px;
            border-top: 1px dashed #bbb;
            padding-top: 35px;
            display: grid; grid-template-columns: repeat(4, 1fr); gap: 20px;
        }

        /* --- 按鈕核心樣式 (修改重點) --- */
        .opt-circle {
            width: 65px; height: 65px;
            border: 2px solid #555;
            border-radius: 50%;
            display: flex; align-items: center; justify-content: center;
            font-size: 1.7rem; font-weight: bold; color: #555;
            cursor: pointer; background: white;
            margin: auto;
            /* 3D 立體陰影效果 */
            box-shadow: 0 5px #999;
            transition: all 0.1s ease; /* 快速過渡，反應靈敏 */
            position: relative; top: 0;
        }

        /* 按壓瞬間的效果 */
        .opt-circle:active {
            background: #f0f0f0;
            box-shadow: 0 2px #666; /* 陰影變小 */
            top: 3px; /* 按鈕下沉 */
        }

        /* --- 批改效果 (修改重點) --- */
        
        /* 答對：藍色系 */
        .correct-mark { 
            border-color: #0984e3 !important; color: #0984e3 !important; 
            background-color: #e8f4fd !important; /* 淡淡藍底 */
            box-shadow: none !important; top: 3px !important; /* 保持按壓狀態 */
        }
        /* 答對時的外圈動畫 */
        .correct-mark::after {
            content: ""; position: absolute; width: 78px; height: 78px;
            border: 3px solid rgba(9, 132, 227, 0.4); border-radius: 50%;
            animation: pulse 0.5s ease-out;
        }

        /* 答錯：紅色系 */
        .wrong-mark { 
            border-color: #d63031 !important; color: #d63031 !important; 
            text-decoration: line-through;
            background-color: #fdeaea !important; /* 淡淡紅底 */
            box-shadow: none !important; top: 3px !important; /* 保持按壓狀態 */
        }

        /* 結果文字顏色 */
        #result-text { text-align: center; font-size: 1.3rem; font-weight: bold; margin-top: 35px; min-height: 35px; }
        .msg-correct { color: #0984e3; } /* 藍字 */
        .msg-wrong { color: #d63031; } /* 紅字 */

        /* 下一題按鈕 */
        #next-btn {
            display: none; width: 100%; max-width: 220px; margin: 40px auto 0; padding: 15px;
            background: #fff; border: 2px solid #333; color: #333; font-size: 1.1rem; 
            font-weight: bold; cursor: pointer; text-align: center; border-radius: 50px;
            box-shadow: 0 4px #999; transition: all 0.1s ease; position: relative; top: 0;
        }
        #next-btn:active { box-shadow: 0 2px #666; top: 2px; background: #f9f9f9; }

        @keyframes pulse {
            0% { transform: scale(1); opacity: 1; }
            100% { transform: scale(1.3); opacity: 0; }
        }
    </style>
</head>
<body>

<div class="paper">
    <div class="exam-header">
        <div class="exam-title">外幣收付非投資型保險模擬試卷</div>
        <div class="exam-info">題型：單選題（請選擇 1、2、3 或 4）</div>
    </div>

    <div class="question-section">
        <div id="question-content">正在從雲端載入試題...</div>
    </div>

    <div class="answer-sheet">
        <div class="opt-circle" onclick="submitChoice('1', this)">1</div>
        <div class="opt-circle" onclick="submitChoice('2', this)">2</div>
        <div class="opt-circle" onclick="submitChoice('3', this)">3</div>
        <div class="opt-circle" onclick="submitChoice('4', this)">4</div>
    </div>

    <div id="result-text"></div>
    <div style="text-align: center;">
        <button id="next-btn" onclick="nextQuestion()">下一題 (Next Question)</button>
    </div>
    
    <div style="margin-top: 60px; text-align: center; color: #aaa; font-size: 0.8rem; letter-spacing: 1px;">
        ※ 僅供個人模擬練習使用
    </div>
</div>

<script>
    // 你的 Google Sheets CSV 網址
    const csvUrl = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vTGHMjjVlQFhWpY-uwzJUWdv6MHGWJo_yRkwXky5575C8d4PgvZwyyszPcce4ySt6SgA7wK-THbl48A/pub?gid=1791464852&single=true&output=csv';
    
    let quizBank = [];
    let currentQuiz = null;

    Papa.parse(csvUrl, {
        download: true,
        header: true,
        complete: function(results) {
            quizBank = results.data.filter(row => row.正確答案 && row.題目內容);
            if (quizBank.length > 0) {
                nextQuestion();
            } else {
                document.getElementById('question-content').innerText = "讀取失敗！請檢查試算表標題是否為「題目內容」與「正確答案」。";
            }
        }
    });

    function nextQuestion() {
        currentQuiz = quizBank[Math.floor(Math.random() * quizBank.length)];
        
        document.getElementById('question-content').innerText = currentQuiz.題目內容;
        document.getElementById('result-text').innerText = "";
        document.getElementById('next-btn').style.display = "none";
        
        // 重設按鈕樣式
        const btns = document.querySelectorAll('.opt-circle');
        btns.forEach(btn => {
            btn.className = 'opt-circle';
            btn.style.pointerEvents = 'auto';
        });
    }

    function submitChoice(userChoice, element) {
        const correctAnswer = currentQuiz.正確答案.toString().trim();
        const resultDiv = document.getElementById('result-text');
        
        document.querySelectorAll('.opt-circle').forEach(btn => btn.style.pointerEvents = 'none');

        if (userChoice === correctAnswer) {
            // 答對：藍色
            element.classList.add('correct-mark');
            resultDiv.innerHTML = '<span class="msg-correct">✓ 答對了！</span>';
        } else {
            // 答錯：紅色
            element.classList.add('wrong-mark');
            resultDiv.innerHTML = `<span class="msg-wrong">✕ 答錯了（正確答案是 ${correctAnswer}）</span>`;
        }
        
        document.getElementById('next-btn').style.display = "block";
    }
</script>

</body>
</html>
